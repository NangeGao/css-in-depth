# 第16章 动画

> **本章内容**
>
> - 使用关键帧动画为页面添加复杂运动
> - 页面加载的时候使用动画
> - 使用旋转器动画提供反馈
> - 吸引用户对保存按钮的注意力，提醒用户去保存

在前面两章里，我们创建了几种过渡行为，可以使元素从某种状态平滑变换为另一种。这为为页面带来了动态的效果，用户体验上也增加了视觉趣味性。但有时候仅仅使用过渡还不够。

过渡是直接从一个地方变换到另一个地方，相比之下，我们可能希望某个元素的变化过程是迂回的路线。有的情况下，我们可能需要元素产生动画运动之后再回到起始的地方。这些事情没办法使用过渡来实现。为了对页面变化有更加精确的控制，CSS提供了关键帧动画。

`关键帧`（keyframe）是指动画过程中某个特定时刻。我们定义一些关键帧，浏览器负责填充或者插入这些关键帧之间的帧图像（图16.1）。

**图16.1 定义关键帧之后，浏览器插入所有关键帧之间的帧图像**

> [p397 图一]
>
> Interpolated frames 插入的帧图像

从原理上看，过渡其实和关键帧动画类似：我们定义第一帧（起始点）和最后一帧（结束点），浏览器计算所有中间值，使得元素可以在这些值之间平滑变换。但使用关键帧动画，我们就不再局限于只能定义两个点，而是想加多少加多少。浏览器负责填充一个个点与点之间的值，直到最后一个关键帧，最终生成一系列无缝衔接的过渡。

在这最后一章，我们将会介绍如何创建关键帧动画。我们会在前一章创建的页面中添加一些动画，然后探索一些其他的使用方式。动画并非只能做一些让页面变得生动的事情，还能向用户传达一些有意义的反馈。

## 16.1 关键帧

CSS中的动画包括两部分：用来定义一组动画的`@keyframes`规则和为元素添加动画的`animation`属性。

下面我们创建一个简单的动画来熟悉一下语法。动画包含三个关键帧，如图16.2所示。第一帧中元素是红色的；第二帧中元素是浅蓝色，并且向右移动了100px；最后一帧中，元素是淡紫色，并且回到了左侧的初始位置。

**图16.2 三个关键帧，分别对元素的颜色和位置添加动画**

> [p397 图二]

动画对`background-color`和`transform`这两个属性做了一些改动。关键帧规则已经列到了下面的清单中，新建样式表styles.css并添加这些代码。

**清单16.1 定义关键帧规则**

> [p397 代码清单一]
>
> [p398 代码清单一]
>
> Names the animation 为动画命名
>
> First keyframe declarations 第一个关键帧声明
>
> Second keyframe occurs halfway through the animation 第二个关键帧发生于动画进行到一半的时候
>
> Final keyframe 最后一个关键帧

关键帧动画都需要名字，示例中的动画被命名为`over-and-back`。动画中使用百分比定义了三个关键帧。这些百分比代表每个关键帧发生于动画过程中的哪个时刻：一个在动画的开始（0%），一个在中间（50%），一个在终点（100%）。每个关键帧块内的声明定义了当前关键帧的样式。

示例中同时为两个属性添加了动画，但我们注意到并不是每个关键帧都设置了两个属性。transform把元素从初始位置移动到右侧，然后再移回原位。但background-color在50%的关键帧中并没有指定。这意味着元素将会从红色（0%的位置）过渡到淡紫色（100%的位置）。在50%的位置，背景颜色恰好是这两个颜色的中间值。

下面我们把这些代码添加到网页中查看工作情况。新建一个HTML文档并添加下列代码。

**清单16.2 只有一个盒子元素的网页，为盒子添加动画**

> [p398 代码清单二]
>
> The element you’ll animate 即将添加动画的元素

接下来在样式表中为盒子添加样式并应用动画，可以复制下面清单中的代码。

**清单16.3 为盒子应用动画**

> [p398 代码清单三]
>
> Gives the element a height and width for demo purposes 为元素添加宽高以便于演示
>
> Applies the animation to the element 为元素应用动画

在浏览器中打开网页，你会看到动画重复执行了三次，然后停下。`animation`属性是好几个属性的简写。在这个demo中，我们实际上指定了四个属性：

- `animation-name`（`over-and-back`）——代表动画名称，就像`@keyframes`规则定义的那样。
- `animation-duration`（`1.5s`）——代表动画持续时间，在本例中是1.5秒。
- `animation-timing-function`（`linear`）——代表时序函数，用来描述动画如何加速和（或）减速。可以是贝塞尔曲线或者关键字值，就像过渡使用的时序函数一样（`ease-in`、`ease-out`等等）。
- `animation-iteration-count`（`3`）——代表动画重复的次数。缺省的时候，默认值是`1`。

刷新页面，再次查看动画播放，观察动画执行过程中的几个地方：

第一，颜色从0%的红色平滑过渡到100%的淡紫色，但是接下来动画重复的时候立即变回红色。如果你打算重复某个动画并希望整体衔接流畅，需要确保结束值和初始值相匹配。

第二，最后一次重复动画结束之后，背景颜色变为绿色，即原样式规则中指定的值。
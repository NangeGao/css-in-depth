# 第10章 模式库

> **本章内容**
>
> - 创建模式库，收录所有的模块
> - 开发过程中引入模式库
> - 使用CSS优先的方案书写样式
> - 安全地编辑和删除CSS
> - 使用Bootstrap之类的CSS框架

在我们开始用模块化的方式书写CSS后，处理web页面和应用的方式也会随之改变。起初的时候，编写页面可能感觉不出什么不同。但是一段时间之后，你组建某个页面的时候就会发现，你已经完成了这个页面所需的很多模块了。举个例子，你可能需要一个媒体对象，或者下拉和导航菜单，你已经创建过它们了，有了一些现成的样式。接下来只需要按照恰当的方式组装元素并添加正确的类名即可。

因为模块是可以复用的，我们在书写页面里这一部分的时候就不需要向样式表里添加新样式了。不同于以往的先写HTML再写样式，只需要使用这些已经存在的模块，组装在一起，就可以生成一个新页面。项目进度越深入，需要写的新CSS就越少。这时候我们需要关注的就不是新CSS，而是样式表里所有可用的模块清单了。

把模块清单整合成一组文档，在大型项目中已经成为通用做法。这组文档被称为`模式库`（pattern library）或者`样式指南`（style guide）。模式库不是网站或者应用的一部分，它是单独的一组HTML页面，用来展示每个CSS模块。模式库是你和你的团队在建站的时候使用的一个开发工具。

这一章将会展示如何创建一个模式库。有非常多的工具可以辅助我们创建模式库（当然，如果你想挑战一下，也可以完全不使用工具）。下面会介绍一款这样的工具，名为KSS，但是我们的关注点会扩展到这款工具之外，讲解一些不局限于这款工具的通用概念。

在模式库建设启动之后，我们会重点介绍模式库带来的好处和它是如何提升开发体验的，特别是对大型项目。本章是第九章的延伸，如果你跳过了前面，强烈建议你退回去先阅读一下第九章。

> **模式库与样式指南**
>
> 有些模式库经常被称为样式指南（或者“在线样式指南”）。实际上样式指南可能更为通用一点，当然了，还是有点区别的。
>
> `样式指南`这个名字，不只意味着关于如何使用模块的技术层面上的说明，也包含了何时何故是否应该使用它们这样偏主观的引导。比较典型的引导是要求开发者遵守一些产品品牌相关的规定。
>
> 如果这种品牌相关的规定对于你的项目是有意义的，那么可以随意添加到模式库。谈论这些就涉及到了市场营销领域而非技术层面。由于本章主要关注技术文档相关的东西，我们就用`模式库`这个名称代替了。

## 10.1 介绍一下KSS

我们有个贯穿全书的观点就是尽量少谈论工具的使用。对CSS里的最重要的概念的理解和应用是无关乎所使用的工具集的，而且我觉得应该重点关注这些概念，而不是关注使用哪个预处理器或者构建工具。

虽然创建模式库的时候不使用任何工具也是可以的，但有了工具的帮助会容易很多。有不少相关功能的工具库可以使用，在搜索引擎里搜索“style guide generator”，就可以找到大量结果。没法确定这些工具里最好的是哪个，但是KSS确实是其中的佼佼者。KSS是Knyle Style Sheets的简写（“Knyle” 来源于作者的名字Kyle Neath）。

接下来演示一下如何设置和运行KSS。配置完成后，KSS会扫描样式表，找到包含`Styleguide`的注释块。开发者可以使用注释块来描述每个模块的功能和用法，KSS正是借此创建HTML文档的。注释块里也可以包含HTML片段，用来说明创建这个模块需要的标记。通过这种方式，KSS在文档中生成了类似图10.1屏幕快照所示的在线demo。

**图10.1 生成下拉模块的KSS文档**

> [p255] 图一

在快照中，左侧是一个菜单，列出了模式库中的各个组成部分。右侧是下拉模块的说明文档（就像第九章我们实现的那个下拉模块一样）。文档中既包含渲染好的下拉菜单，也展示了需要用到的HTML标记。通过查看文档，任何熟悉HTML的开发者都可以轻松地复制这些标记到页面里，然后在样式表的作用下生成相应的效果。

### 10.1.1 配置KSS

最初的时候KSS是一个Ruby应用。我们现在基于前端开发的领域在探讨，你对JavaScript可能更熟悉一点，所以接下来会演示如何安装KSS的Node.js工具。

如果你还没有安装Node.js，可以访问[https://nodejs.org](https://nodejs.org)免费获取，然后按照指导下载安装。Node自带了一个包管理器（叫做npm），我们可以通过它来安装KSS。安装过程中用到的命令会提供给你，但如果想要了解更多关于npm的信息，或者遇到问题寻求帮助，可以访问[https://docs.npmjs.com/getting-started](https://docs.npmjs.com/getting-started)。

**初始化项目**

Node和npm安装好以后，可以在文件系统的任意地方为项目创建目录。在终端界面访问目录，运行`npm init -y`来初始化一个新项目。`-y`选项会为项目名称、许可和其他配置自动设置默认值（如果没有使用`-y`选项，npm会提醒你输入这些值）。

初始化项目之后，npm会创建一个package.json文件，以JSON格式展示项目的npm元数据。

**清单10.1 生成package.json文件**

> [p256 代码清单一]
>
> Brief name of your npm project 简明扼要的npm项目名称
>
> Version number 版本号
>
> Longer description of the project can be filled in here 关于项目的大段描述可以放在这里

接下来，我们可以安装KSS作为一个`依赖`（dependency）。在终端里输入`npm install
--save-dev kss`，这句话做了两件事情：一是在项目中创建了一个node_modules目录，KSS和它的依赖将会安装在这里；另一个是把“kss”写入package.json文件中描述开发依赖的列表（devDependencies）。

**添加KSS配置**

KSS需要一个配置文件。这个文件为KSS提供访问目录和文件的路径，然后KSS使用目录和文件来创建模式库。在项目目录下新建一个名为kss-config.json的文件，复制下列代码到文件中。

**代码10.2 KSS配置文件（kss-config.json）**

> [p256 代码清单二]
>
> Path to CSS source files directory (which KSS will scan)  CSS源文件的目录路径（KSS将要扫描的）
>
> Path to where the generated pattern library will be written 生成的模式库文件将被写入的路径
>
> Path to stylesheet (relative to destination directory) 样式表文件路径（相对于destination目录）
>
> Path to any javascript (relative to destination directory) 一些JavaScript文件路径（相对于destination目录）

source路径告诉KSS去哪里寻找CSS源文件，然后KSS才可以扫描源文件里面的文档注释。KSS根据这些注释在目标目录里生成模式库的页面。

`css`和`js`字段里列出的每个文件都会被添加到模式库页面。我们已经为它们各自配置了一个css和js目录，现在就可以去创建这两个目录和里面的源文件（css/styles.css和js/docs.js）。文件目前是空的，很快就会向里面添加内容。

> **注意**
>
> 在我们这个例子中，`css`字段列出的样式表文件是和源文件在同一个目录下的。如果使用了预处理器，比如SASS或者Less，源文件目录应该指向SASS或者Less文件，但是`css`字段应该指向编译生成的CSS样式表。

在配置过程的最后，我们为package.json添加一条命令，用来通知KSS构建模式库。在package.json文件的scripts部分添加一条记录，如下面的代码清单所示。

**清单10.3 在package.json中添加构建脚本**

> [p257 代码清单一]
>
> Defines a build command 定义构建命令

这样就添加了一条构建命令。在终端里运行`npm run build`，就可以通知NPM启动KSS（在node_modules目录中），加载传递过来的KSS配置文件了。但是运行以后我们发现报错了：“Error: No KSS documentation discovered in source files.”。这是因为KSS找不到文件，我们现在开始编写文档。

### 10.1.2 编写KSS文档

现在要添加第九章里的一些模块到模式库。首先添加媒体模块，效果如图10.2所示。KSS构建页面完成以后，左侧的目录里会添加媒体项，右侧会渲染文档。

**图10.2 媒体模块的文档**

> [p258 图一]

KSS会按照特定的方式在样式表中搜寻注释。注释中包含了标题（通常是模块名称）、描述信息、示例HTML代码和用来表示该模块在目录中位置的`Styleguide`标记。这几个部分之间通过空白行彼此间隔，便于KSS区分它们。严格来讲，只有最后的Styleguide声明是KSS必需的，但是通常我们也应该好好编写其余的部分。

把下面清单中的代码添加到css/styles.css样式表中，其中包含了一些基础样式和媒体模块。模块样式代码的上面就是为KSS提供的CSS注释块。

**清单10.4 包含KSS文档注释掉媒体对象**

> [p258 代码清单一]
>
> [p259 代码清单一]
>
> Title (name of the module) 标题（模块名称）
>
> Description of the module and its use 描述模块及其用途
>
> HTML example illustrating use of the module 模块使用方法示例
>
> Styleguide annotation, adding this to the table of contents as Media  Styleguide标记，以Media命名把模块添加到目录

在终端里重新运行`npm run build`，KSS会生成docs目录，其中包含一个section-media.html文件。在浏览器中打开这个文件就可以看到模式库了。KSS同时也输出了一条警告：“No homepage content found in homepage.md”，后面会讲解如何解决。现在我们来分析一下文档注释的部分。前面的几行看起来是这样的：

```
/* 
Media

Displays an image on the left and body content on the right.
```

注释的第一行定义了这部分文档的标题（Media），后面的一段文本用来描述模块用途。这段描述文本可以使用`markdown`格式，所以根据个人意愿可以添加一些样式。描述也可以是多段。

> **markdown**是一种通用的文本格式，通过添加标记来生成基础样式。星号包裹的文字生成斜体；反引号（`）包裹的文字标记为代码。可以查看[https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet)获取全部资料。

我们新建了一个模块，可以通过描述文本向其他开发者介绍使用模块时需要了解的东西。有时候简单的一句话就够了，但有时候我们可能需要说明模块依赖JavaScript，或者需要结合其他模块一起使用。这是与样式表使用相关的文档部分。

描述后面是一个`Markup:`标记。后面紧跟一大段HTML代码，用来举例说明模块的用法。KSS把这些HTML转化成模式库，便于读者预览效果。接下来，HTML代码被展示为可读性良好的格式，读者可以拷贝代码：

```
Markup:
<div class="media">
  <img class="media__image"
    src="http://placehold.it/150x150" />
  <div class="media__body">
    <h4>Strength</h4>
    <p>
      Strength training is an important part of
      injury prevention. Focus on your core&mdash;
      especially your abs and glutes.
    </p>
  </div>
</div>
```

示例中具体使用哪些文字和图片不重要，只是用来向开发者展示如何使用模块。在这里例子里，我们使用了[http://placehold.it](http://placehold.it)网站提供的占位图片。开发者使用模块的时候，他们可以替换为自己需要的内容。

> **警告**
>
> 要牢记HTML片段中不能有空白行，因为对KSS来讲，空白行就意味着markup这部分结束了。

KSS注释的最后一行需要包含Styleguide标记，后面跟着目录标签（本例中是Media）。

```
Styleguide Media
*/
```

这必须是注释块的最后一行。如果没有这一行，KSS会忽略整个注释块。

当有需要修改样式表的时候，也需要相应地修改注释文档。把文档放在源代码里，这个过程就会很顺利。新增一个模块的时候，也同时新增一个文档注释块。每次修改以后，都要重新运行`npm run build`命令，生成模式库的全新副本。

> **警告**
>
> KSS生成新页面的时候不会主动删除旧页面。如果重命名或者移动源码中的一部分文档，docs目录下的相应文件还在原地，与新文件共存。我们刷新浏览器的时候，要确认一下不是在重新加载旧页面。

因为模式库是和它展示的样式“住”在一起的，任何有权限访问样式表的开发者都可以访问到它的文档。而你可能也希望把模式库放在网络上，这样整个开发团队都可以访问了。

### 10.1.3 记录模块变体

下面我们来记录另一类模块（见清单10.5）。首先从上一章引入按钮模块。这个模块提供了几种变体：两个颜色变换和两个尺寸变换。KSS提供了阐述多重变体的方法，可以在模式库里把每个都展示出来。最终的效果如图10.3所示。

按钮模块的文档注释跟之前的类似，但我们需要在标记后面添加一段新内容来描述每个修饰符（如清单10.5所示）。这是一组修饰符类的列表，每个列表项后面跟着一个连字符和相关描述。我们也可以添加`{{modifier_class}}`标识到示例标记上，指明修饰符类所属的位置。

**图10.3 带变体的按钮模块**

> [p262 图一]

**清单10.5 按钮模块及其文档**

> [p262 代码清单一]
>
> Indicates where the modifier classes are used  代表修饰符类使用的位置
>
> Lists available modifier classes  列出可用的修饰符类
>
> [p263 代码清单一]

KSS会扫描定义的修饰符类列表，把每一个都展示到模式库中。`{{modifier_class}}`标识指明放置修饰符类的位置（如果你熟悉handlebars模板，这种语法看上去有点类似。）。
# 第14章 过渡

> 本章内容
>
> * 使用过渡为网页引入动态效果
> * 理解时序函数并选择合适的效果
> * 配合JavaScript使用



在传统的打印媒介上，事物都是静止不动的。文字不能在纸上移动，颜色也不能变化。但是web是个新鲜生动的媒介，可以做更多的事情，比如元素可以渐隐、菜单可以划入、颜色可以从一种变为另一种，使用`过渡`（transitions）是实现这些效果最简单的方式。

当某个值发生变化的时候，通过使用CSS过渡，你可以告知浏览器使用“ease”方式来实现变化过程。比如，我们有个蓝色的链接，其悬浮状态是红色，如果使用了过渡，当用户鼠标划到元素上面的时候，链接会从蓝色过渡到紫色再过渡到红色，鼠标划走的时候再变回去。如果正确使用，过渡可以增强页面的交互效果，而且因为我们的眼睛更容易被动态的东西吸引，当变化产生时可以更好地获得用户注意。

页面上一般不会添加太多的过渡效果。本章我们会学习如何实现过渡，添加过程中如何选择合适的过渡效果。因为有些使用案例可能会比较复杂，我们也会研究一下如何解决这些问题。

## 14.1 从这边到那边

过渡是通过一系列`transition-*`属性来实现的。如果某个元素设置了过渡，当它的属性值发生变化的时候，并不是直接变成新值，而是使用过渡效果。

我们使用按钮创建一个基础示例，演示一下过渡是如何工作的。最开始是个青绿色方角按钮，鼠标悬浮的时候，过渡成一个红色圆角按钮。图14.1展示了这两种状态，同时还有过渡中间状态。

**图14.1 过渡前、过渡中和过渡后的元素**

> [p354 图一]

添加按钮到一张新页面并链接样式表。按钮的标记代码如下：

**清单14.1 为页面添加简单的按钮**

> [p354 代码清单一]

然后把样式添加到样式表。这些样式定义了正常和悬浮两种状态，其中有两条过渡属性，用来指导浏览器如何在两种状态之间流畅过渡。

**清单14.2 使用过渡效果的按钮样式**

> [p354 代码清单二]
>
> Teal button 青绿色按钮
>
> Transitions all property changes 所有属性变化都使用过渡效果
>
> Transitions for 0.5 seconds 过渡时间为0.5秒
>
> Hover state red button with border radius 悬浮状态为带圆角的红色按钮

`transition-property`这条属性可以指定哪些属性使用过渡。在示例中，关键字`all`意味着所有的属性变化都使用过渡。`transition-duration`属性代表着过渡到最终值之前需要多长时间，本例中设置为`0.5s`，代表0.5秒。

加载页面并使用鼠标划过按钮，就可以查看过渡效果。注意`border-radius`属性平滑地从0过渡到1em，虽然非悬浮状态并没有明确设置边框圆角为0。按钮自动设置了初始值为0，过渡是从0开始的。可以在悬浮状态尝试更改一下其他属性，比如`font-size`和`border`。

元素属性任何时候产生变化都会触发过渡：可以是状态改变的时候，比如`:hover`；也可以是JavaScript导致变化的时候，比如添加或者移除类影响了元素的样式。

注意，我们没有在`:hover`规则集里设置过渡属性，而是把过渡属性设置在了一个始终指向该元素的选择器，虽然我们的目的确实是要在鼠标悬浮时添加过渡。我们希望进入悬浮状态时（淡入过渡）和退出悬浮状态时（淡出过渡）都有过渡。其他属性可以发生变化，但你肯定不想过渡属性本身发生变化。

也可以使用简写的属性`transition`，语法如图14.2所示。简写的属性接受四个参数值，分别代表过渡属性`transition-property`、`transition-duration`、`transition-timing-function`和`transition-delay`。

**图14.2 `transition`简写属性的语法**

> [p355 图一]
>
> Affected property 生效的属性
>
> Duration 持续时间
>
> Timing function 时序函数
>
> Delay 延迟时间

第一个值用来设置哪个属性需要过渡，默认值是关键字`all`，表示所有属性都生效。如果只有某个属性需要过渡，在这里指定属性即可。例如`transition-property: color`将只应用在元素的颜色上，其他属性会立刻发生变化。也可以设置多个值，比如`transition-property: color, font-size`。

第二个值是持续时间，是一个用秒（例如`0.3s`）或者毫秒（`300ms`）表示的时间值。

> **警告**
>
> 跟长度值不太一样，0不是一个有效的时间值。你必须为时间值添加一个单位（`0s`或者`0ms`），否则声明将会不可用，被浏览器忽略。

第三个值是时序函数，用来控制属性的中间值如何计算，实际上控制的是过渡过程中变化率如何加速或者减速。时序函数可以是一个关键字值，比如`linear`或者`ease-in`，也可以是自定义函数。这是过渡中很重要的部分，稍后会详细说明。

最后一个值是延迟时间，允许开发者在属性值改变之后过渡生效之前设置一个等待周期。如果你为按钮的悬浮状态设置`0.5s`的过渡延迟，那么在鼠标指针进入元素0.5秒之后才会开始发生变化。

如果需要为两个不同的属性分别设置不同的过渡，可以添加多个过渡规则，以逗号分隔：

```
transition: border-radius 0.3s linear, background-color 0.6s ease;
```

相应地，如果使用普通写法，上面的代码等价于：

```
transition-property: border-radius, background-color;
transition-duration: 0.3s, 0.6s;
transition-timing-function: linear, ease;
```

本章后面将会有使用多个过渡的例子。

## 14.2 时序函数

时序函数是过渡中非常重要的一部分。过渡让某个属性从一个值“移动”到另一个值，时序函数用来说明`如何`移动。是以恒定的速度移动吗？还是开始的时候慢，后面越来越快？

我们可以使用几个关键字值来描述移动过程，比如`linear`、`ease-in`和`ease-out`。使用`linear`过渡，值以固定的速度改变；使用`ease-in`，变化速度开始的时候慢，然后一直加速，直到过渡完成；`ease-out`是减速，开始的时候快速变化，结束的时候比较慢。图14.3阐述了这几种时序函数下，小盒子如何从左边移动到右边。

**图14.3 linear过渡以恒定的速度移动，ease-in加速，ease-out减速**

> [p356 图一]

从静态图片上不太容易想象这个过程，我们创建一个例子，在浏览器中动态查看一下。新建一个HTML页面并添加下列代码：

**清单14.3 一个简单的时序函数演示**

> [p356 代码清单一]
>
> You’ll transition this box across the screen from left to right. 这个盒子将会从屏幕左边过渡到右边

接下来为盒子设置样式，添加一些颜色和尺寸。然后为盒子绝对定位，当鼠标划上的时候移动它的位置。为页面添加新样式表，并复制下面清单中的代码：

**清单14.4 使盒子从左边过渡到右边**

> [p357 代码清单一]
>
> Starts positioned to the left 开始的时候定位到最左侧
>
> Applies a transition 设置过渡
>
> Moves 400 px to the right on hover 鼠标悬停时向右移动400px

演示页面左上角将会绘制一个小绿盒子。鼠标悬停到容器上时，盒子向右侧移动。注意它将会以固定不变的速度移动。

> **警告**
>
> 演示页面通过为元素设置绝对定位并过渡`left`属性来实现它在屏幕上的移动。然而有一些属性因为性能原因需要避免使用过渡，其中就包含`left`。接下来的章节会讲到这个问题，并使用转换作为更好的替代方案。

现在可以编辑过渡属性查看不同的时序函数是如何工作的，尝试一下ease-in（`transition: all 1s ease-in`）和ease-out（`transition: all 1s ease-out`）。仅使用这些关键字值就可以完成工作了，但有时候你可能希望有更多的控制。这时候就需要自己定义时序函数，下面来看一下如何实现。

### 14.2.1 理解贝塞尔曲线

时序函数是基于数学定义的贝塞尔曲线（Bézier curves）。浏览器使用贝塞尔曲线作为随时间变化的函数，来计算某个属性的值。图14.4展示了几种时序函数的贝塞尔曲线，同时这几个关键字值都可以用作时序函数。

这些贝塞尔曲线都是从左下方开始，持续延伸到右上方。时间是从左向右递进的，曲线代表某个值在到达最终值的过程中是如何变化的。linear时序函数在整个过渡期间是个稳定的过程，呈现为一条直线。其他时序函数有弯曲的地方，代表加速或者减速。

**图14.4 时序函数的贝塞尔曲线描述了值是如何随时间变化的**

> [p358 图一]

但我们不应该局限在这五种关键词贝塞尔曲线上。我们可以定义自己的三次贝塞尔曲线（ubic Bézier curve），实现更温和或者更激烈的过渡效果，甚至可以添加一点“弹跳”效果。下面我们来试一下。

在刚才创建的页面上，打开开发者工具并检查小绿盒子元素。在Styles面板（Chrome）或者Rules面板（Firefox）中，你会发现时序函数旁边有一个小小的标志符号。点击标志符号会打开一个弹窗，可以在弹窗中修改时序函数的曲线（如图14.5）。

**图14.5 在Chrome的开发者工具中修改贝塞尔曲线**

> [p358 图二]

在弹窗左侧，界面上提供了一系列预设的曲线（Firefox提供的比Chrome多多了），点击曲线就可以直接选取。弹窗右侧展示选中的贝塞尔曲线。

曲线的每个末端都有一条短直线（`控制柄`），直线上有个小圆点，称为`控制点`（control points）。点击并拖动小圆点可以改变曲线的形状，注意控制柄的长度和方向是如何“牵引”曲线的。

点击弹窗外部可以关掉弹窗，可以看到时序函数已经更新了。替换掉了之前的类似`ease-out`这样的关键字，改成了像`cubic-bezier(0.45, 0.05, 0.55, 0.95)`这样的写法。`cubic-bezier()`函数和4个参数共同组成了自定义时序函数。

> **选择时序函数**
>
> 不管你使用关键字时序函数还是自定义贝塞尔曲线，了解一下什么时候该使用哪种都是很有用的。每个网站或者应用都应该包含一条减速曲线（ease-out）、一条加速曲线（ease-in）和`linear`关键字。最好的做法是复用相同的几条曲线，提供更加一致的用户体验。
>
> 你可以在下列场景中分别使用这三种函数：
>
> - 线性——颜色变化和渐隐、渐显效果。
>
> - 减速——用户发起的变化。用户点击按钮或者划过元素的时候，使用`ease-out`或者类似曲线。这样用户就可以看到快速发生的反馈，及时响应输入，然后元素慢慢过渡到最终状态。
>
> - 加速——系统发起的变化。当内容加载完成或者超时事件触发的时候，使用`ease-in`或者类似曲线。这样元素就可以慢慢引起用户注意，然后速度越来越快直到完成最终变化。
>
>   当然，这些都不是硬性规定，只是提供了一些思路，如果感觉不太合适，完全可以不用遵守这些规则。有时候你可能还需要更多的曲线来实现更复杂或者更有趣的过渡，可以使用`ease-in-out`（先加速后减速）或者弹跳效果（第15章有弹跳的示例）。

下面我们进一步研究一下`cubic-bezier()`是如何工作的。图14.6展示了另一种曲线。

这张图片上是一条自定义贝塞尔曲线。这条曲线开始的时候加速，在中间的时候达到最快（曲线上最陡峭的部分），到后面开始减速。曲线位于笛卡尔网格内，从点（0，0）开始，到点（1，1）结束。

两端的端点既然确定了，只需要再确定两条控制柄的位置就可以定义曲线了。在CSS中，曲线可以通过`cubic-bezier(0.45, 0.05, 0.55, 0.95)`来定义，其中的四个参数分别代表两个控制柄的控制点的x和y坐标。

**图14.6 贝塞尔曲线表示时序函数**

> [p360 图一]

我们很难通过这些数字想象出来曲线的具体样式。使用图形化工具来编辑曲线更符合一贯做法，所以我会在复制贝塞尔曲线的结果到样式表之前，先在浏览器中编辑测试一下过渡效果。我比较喜欢使用开发者工具，你也可以使用一些在线工具，比如[http://cubic-bezier.com/]( http://cubic-bezier.com/)。

### 14.2.2 阶跃

最后再介绍一种时序函数，即`steps()`函数。前面介绍的是从一个值到另一个值的基于贝塞尔曲线的流畅过渡，跟之前不同，这个函数是一系列离散的瞬时“阶跃”。

阶跃函数需要两个参数：阶跃次数和一个用来表示每次变化发生在阶跃的开始还是结束的关键词（`start`或者`end`）。图14.7描述了一些阶跃函数。

**图14.7 `step()`函数递增改变值**

> [p360 图二]
>
> 【译者注】这里的第3和第4幅图放错了，应该调换一下顺序

注意第二个参数的默认值是`end`，所以`steps(3)`可以用来代替`steps(3,end)`。按下面清单编辑样式表，查看阶跃的实际效果。

**清单14.5 使用`steps()`增加值**

> [p361 代码清单一]
>
> Transitions in three discrete steps 三次不连续的跃迁过渡

现在就不是一秒内（过渡持续时间）流畅地从左到右移动了，时间被分成了三等份，或者说三步。每一步的时候，盒子分别出现在开始的位置、三分之一的位置、三分之二的位置，最后在1秒的时刻移动到最终位置。

> **注意**
>
> 默认情况下，属性值在每一步结束的时候改变，所以过渡不会立即开始。添加`start`关键词，使用`steps(3, start)`就可以改变这种行为，这样过渡就会发生在每步开始的时候，而不是结束。

`steps()`函数的实际应用并不是很常见，这里有份清单可以提供一些灵感[https://css-tricks.com/clever-uses-step-easing/](https://css-tricks.com/clever-uses-step-easing/)。

## 14.3 非动画属性

大部分的过渡都很容易理解。比如，对链接使用`transition: color 200ms linear`，当鼠标划过或者点击的时候，它们就会从一种颜色过渡到另一种。你也可以对可点击栏目的背景颜色或者按钮的内边距使用过渡。

如果JavaScript修改了页面上的东西，你可能考虑是不是需要添加一些过渡效果。有些情况下比较简单，就和为元素添加过渡属性差不多，遇到复杂的情况就需要一些额外配置了。本章接下来的内容会介绍如何创建下拉菜单并添加过渡效果，这样菜单打开的时候比较柔和，不是突兀地出现。

首先，需要设置菜单为渐显，为`opacity`属性添加过渡。然后修改下拉动作实现不一样的效果，为`height`添加过渡。但这两步都出现了一些问题，我们需要再思考一下。

菜单的外观如图14.8所示。我们先从实现菜单的打开和关闭开始，然后添加过渡效果。菜单下方有个链接，注意菜单的抽屉浮层打开的时候是如何出现在链接上方的，这非常重要。

**图14.8 下拉菜单的关闭（左边）和打开（右边）状态**

> [p361 图一]

为下拉菜单新建一个页面，添加下面清单中的代码。这和前面章节创建的下拉菜单差不多，同时也包含了一些JavaScript来触发菜单的打开和关闭状态。

**清单14.6 过渡效果下拉菜单**

> [p362 代码清单一]
>
> The drawer that will appear and disappear to reveal the menu 抽屉将会显示和隐藏，以此来展示菜单
>
> A link that will appear below the dropdown 显示在下拉菜单下方的链接
>
> Toggles the is-open class on the container when the button is clicked 按钮点击的时候在容器上添加和删除is-open类

没添加渐显特效之前的样式展示在了下面的清单中。把这些代码放到样式表中，并链接到页面上。代码中已经添加了一些过渡效果，鼠标划过的时候，颜色可以平滑过渡。除此之外并没有太多新内容，页面已经可以正常运行了，这样你就可以专心研究如何创建渐显特效了。

**清单14.7 过渡效果下拉菜单的样式**

> [p362 代码清单二]
>
> [p363 代码清单一]
>
> Transitions the background color when it changes 背景色改变的时候添加过渡效果
>
> Changes the background color on hover 鼠标划过的时候改变背景颜色
>
> Transitions background and text colors 为背景颜色和文本颜色添加过渡
>
> Changes the colors on hover 鼠标划过的时候改变颜色

在浏览器中打开网页查看实际效果。你可以点击开关按钮打开和关闭菜单。注意观察按钮和菜单链接在鼠标划过的时候是如何平滑过渡颜色的，鼠标移开又是如何变化的。

这里对悬浮效果使用了0.2秒的过渡持续时间。按照经验来讲，大部分的过渡持续时间应该介于200和500毫秒之间。时间如果再长，用户就会感觉页面变得卡慢，页面响应让他们产生了无谓的等待，尤其是面对那些经常或者重复使用的过渡特效的时候。

> **小贴士**
>
> 对于鼠标悬浮、渐显渐隐和轻微缩放特效，应该使用较快的过渡速度。一般要控制在300毫秒以下，有时候甚至可能要低到100毫秒。对于那些包含较大移动或者复杂时序函数的过渡，比如弹跳特效（见第15章），要使用较长的介于300到500毫秒的持续时间。

我在处理过渡的时候，有时会放慢到两三秒。这样我就可以仔细观察过渡过程，确保是按我想要的效果在运行。如果你也这样做，记得在完成之后改回合适的速度。

### 14.3.1 不可添加动画效果的属性

不是所有属性都可以添加动画效果，`display`属性就是其中之一。你可以在`display: none`和`display: block`中任选其一，但不能在这俩值之间过渡，所以任何应用到`display`上的过渡属性都会被忽略。

如果你在MDN（[https://developer.mozilla.org/en-US/](https://developer.mozilla.org/en-US/)）之类的参考指南上查阅属性，它们会明确告诉你某个属性是否可以添加动画效果，什么类型的值（比如长度、颜色、百分比）可以以内插值替换（【译者注】内插值是指为了达到流畅的动画效果，在两个值之间插入一系列计算好的值，计算逻辑及插值速度取决于时序函数）。[https://developer.mozilla.org/en-US/docs/Web/CSS/background-color](https://developer.mozilla.org/en-US/docs/Web/CSS/background-color)中关于`background-color`属性的细节展示在图14.9中。

**图14.9 MDN文档为每个属性都提供了技术能力总结框**

> [p364 图一]

如图所示，`background-color`属性只有一个颜色值的时候才可以添加动画，意思是从一个颜色过渡到另一个颜色（这就意味着属性必须设置为单一颜色值）。属性的动画类型不仅用于过渡，还可用于第16章要讲的动画。文档中还列出了关于属性的一些其他的有用信息，比如它的原始值，哪种类型的元素可以使用，是否可以继承等。如果你需要一份如何使用某个属性的技术能力总结，可以在MDN文档中找到该属性并查找它的属性框。

> **注意**
>
> 大部分的接受长度值、数字、颜色值或者`calc()`函数值的属性都可以添加动画效果；大部分的使用关键字值或者其他非连续性值的属性（比如`url()`）都不可以使用动画。
# 第14章 过渡

> 本章内容
>
> * 使用过渡为网页引入动态效果
> * 理解时序函数并选择合适的效果
> * 配合JavaScript使用



在传统的打印媒介上，事物都是静止不动的。文字不能在纸上移动，颜色也不能变化。但是web是个新鲜生动的媒介，可以做更多的事情，比如元素可以渐隐、菜单可以划入、颜色可以从一种变为另一种，使用`过渡`（transitions）是实现这些效果最简单的方式。

当某个值发生变化的时候，通过使用CSS过渡，你可以告知浏览器使用“ease”方式来实现变化过程。比如，我们有个蓝色的链接，其悬浮状态是红色，如果使用了过渡，当用户鼠标划到元素上面的时候，链接会从蓝色过渡到紫色再过渡到红色，鼠标划走的时候再变回去。如果正确使用，过渡可以增强页面的交互效果，而且因为我们的眼睛更容易被动态的东西吸引，当变化产生时可以更好地获得用户注意。

页面上一般不会添加太多的过渡效果。本章我们会学习如何实现过渡，添加过程中如何选择合适的过渡效果。因为有些使用案例可能会比较复杂，我们也会研究一下如何解决这些问题。

## 14.1 从这边到那边

过渡是通过一系列`transition-*`属性来实现的。如果某个元素设置了过渡，当它的属性值发生变化的时候，并不是直接变成新值，而是使用过渡效果。

我们使用按钮创建一个基础示例，演示一下过渡是如何工作的。最开始是个青绿色方角按钮，鼠标悬浮的时候，过渡成一个红色圆角按钮。图14.1展示了这两种状态，同时还有过渡中间状态。

**图14.1 过渡前、过渡中和过渡后的元素**

> [p354 图一]

添加按钮到一张新页面并链接样式表。按钮的标记代码如下：

**清单14.1 为页面添加简单的按钮**

> [p354 代码清单一]

然后把样式添加到样式表。这些样式定义了正常和悬浮两种状态，其中有两条过渡属性，用来指导浏览器如何在两种状态之间流畅过渡。

**清单14.2 使用过渡效果的按钮样式**

> [p354 代码清单二]
>
> Teal button 青绿色按钮
>
> Transitions all property changes 所有属性变化都使用过渡效果
>
> Transitions for 0.5 seconds 过渡时间为0.5秒
>
> Hover state red button with border radius 悬浮状态为带圆角的红色按钮

`transition-property`这条属性可以指定哪些属性使用过渡。在示例中，关键字`all`意味着所有的属性变化都使用过渡。`transition-duration`属性代表着过渡到最终值之前需要多长时间，本例中设置为`0.5s`，代表0.5秒。

加载页面并使用鼠标划过按钮，就可以查看过渡效果。注意`border-radius`属性平滑地从0过渡到1em，虽然非悬浮状态并没有明确设置边框圆角为0。按钮自动设置了初始值为0，过渡是从0开始的。可以在悬浮状态尝试更改一下其他属性，比如`font-size`和`border`。

元素属性任何时候产生变化都会触发过渡：可以是状态改变的时候，比如`:hover`；也可以是JavaScript导致变化的时候，比如添加或者移除类影响了元素的样式。

注意，我们没有在`:hover`规则集里设置过渡属性，而是把过渡属性设置在了一个始终指向该元素的选择器，虽然我们的目的确实是要在鼠标悬浮时添加过渡。我们希望进入悬浮状态时（淡入过渡）和退出悬浮状态时（淡出过渡）都有过渡。其他属性可以发生变化，但你肯定不想过渡属性本身发生变化。

也可以使用简写的属性`transition`，语法如图14.2所示。简写的属性接受四个参数值，分别代表过渡属性`transition-property`、`transition-duration`、`transition-timing-function`和`transition-delay`。

**图14.2 `transition`简写属性的语法**

> [p355 图一]
>
> Affected property 生效的属性
>
> Duration 持续时间
>
> Timing function 时序函数
>
> Delay 延迟时间

第一个值用来设置哪个属性需要过渡，默认值是关键字`all`，表示所有属性都生效。如果只有某个属性需要过渡，在这里指定属性即可。例如`transition-property: color`将只应用在元素的颜色上，其他属性会立刻发生变化。也可以设置多个值，比如`transition-property: color, font-size`。

第二个值是持续时间，是一个用秒（例如`0.3s`）或者毫秒（`300ms`）表示的时间值。

> **警告**
>
> 跟长度值不太一样，0不是一个有效的时间值。你必须为时间值添加一个单位（`0s`或者`0ms`），否则声明将会不可用，被浏览器忽略。

第三个值是时序函数，用来控制属性的中间值如何计算，实际上控制的是过渡过程中变化率如何加速或者减速。时序函数可以是一个关键字值，比如`linear`或者`ease-in`，也可以是自定义函数。这是过渡中很重要的部分，稍后会详细说明。

最后一个值是延迟时间，允许开发者在属性值改变之后过渡生效之前设置一个等待周期。如果你为按钮的悬浮状态设置`0.5s`的过渡延迟，那么在鼠标指针进入元素0.5秒之后才会开始发生变化。

如果需要为两个不同的属性分别设置不同的过渡，可以添加多个过渡规则，以逗号分隔：

```
transition: border-radius 0.3s linear, background-color 0.6s ease;
```

相应地，如果使用普通写法，上面的代码等价于：

```
transition-property: border-radius, background-color;
transition-duration: 0.3s, 0.6s;
transition-timing-function: linear, ease;
```

本章后面将会有使用多个过渡的例子。

## 14.2 时序函数

时序函数是过渡中非常重要的一部分。过渡让某个属性从一个值“移动”到另一个值，时序函数用来说明`如何`移动。是以恒定的速度移动吗？还是开始的时候慢，后面越来越快？

我们可以使用几个关键字值来描述移动过程，比如`linear`、`ease-in`和`ease-out`。使用`linear`过渡，值以固定的速度改变；使用`ease-in`，变化速度开始的时候慢，然后一直加速，直到过渡完成；`ease-out`是减速，开始的时候快速变化，结束的时候比较慢。图14.3阐述了这几种时序函数下，小盒子如何从左边移动到右边。

**图14.3 linear过渡以恒定的速度移动，ease-in加速，ease-out减速**

> [p356 图一]

从静态图片上不太容易想象这个过程，我们创建一个例子，在浏览器中动态查看一下。新建一个HTML页面并添加下列代码：

**清单14.3 一个简单的时序函数演示**

> [p356 代码清单一]
>
> You’ll transition this box across the screen from left to right. 这个盒子将会从屏幕左边过渡到右边

接下来为盒子设置样式，添加一些颜色和尺寸。然后为盒子绝对定位，当鼠标划上的时候移动它的位置。为页面添加新样式表，并复制下面清单中的代码：

**清单14.4 使盒子从左边过渡到右边**

> [p357 代码清单一]
>
> Starts positioned to the left 开始的时候定位到最左侧
>
> Applies a transition 设置过渡
>
> Moves 400 px to the right on hover 鼠标悬停时向右移动400px

演示页面左上角将会渲染一个小绿盒子。鼠标悬停到容器上时，盒子向右侧过渡。注意它将会以固定不变的速度移动。

> **警告**
>
> 演示页面通过为元素设置绝对定位并过渡`left`属性来实现它在屏幕上的移动。然而有一些属性因为性能原因需要避免使用过渡，其中就包含`left`。接下来的章节会讲到这个问题，并使用转换作为更好的替代方案。

现在可以编辑过渡属性查看不同的时序函数是如何工作的，尝试一下ease-in（`transition: all 1s ease-in`）和ease-out（`transition: all 1s ease-out`）。仅使用这些关键字值就可以完成工作了，但有时候你可能希望有更多的控制。这时候就需要自己定义时序函数，下面来看一下如何实现。

### 14.2.1 理解贝塞尔曲线


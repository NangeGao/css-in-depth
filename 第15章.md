# 第15章 变换

> 本章内容
>
> * 使用变换操作元素，提升过渡和动画的性能
> * 为过渡添加“弹跳”效果
> * 浏览器的绘制管道
> * 了解一下3D变换和透视图



本章我们学习一下`transform`（变换）属性，它可以用来改变页面元素的形状和位置，其中包括二维或者三维的旋转、缩放和倾斜。变换通常结合过渡或动画一起使用，这也是为什么我们把本章内容放在这两个话题之间。在这最后的两章中，你会用到大量的过渡、变换和动画来创建页面。

首先，我们看看如何在静态元素上应用变换。这样就可以理解这些变换行为是怎样独立工作的，便于后面把变换添加到过渡中。然后我们会创建一个稍微复杂的小菜单，用到多种变换和过渡效果。最后再看一下如何使用3D变换和透视图。这部分内容会一直延续到下一章，到时候我们会使用3D变换配合动画一起使用。

## 15.1 旋转、平移、缩放和倾斜

基本的变换规则看起来像下面这样：

`transform: rotate(90deg);`

这条规则应用到元素上之后，会使元素向右（顺时针）旋转90度。变换函数`rotate()`用来指定元素如何变换。还有其他几种不同的变换函数，这些函数通常被分成以下四类（在图15.1中有演示）：

- `旋转`（Rotate）——元素绕着一个轴心转动一定角度
- `平移`（Translate）——元素向上、下、左、右各个方向移动（有点类似相对定位）
- `缩放`（Scale）——缩小或放大元素
- `倾斜`（Skew）——使元素变形，顶边滑向一个方向，底边滑向相反的方向。

**图15.1 四种基本变换类型（虚线框代表元素的初始位置）**

> [p371 图一]

每种变换都使用相应的函数作为`transform`属性的值。下面我们新建一个简单的示例，在浏览器中试一下。这是一张带图文的卡片（图15.2），我们对其使用变换效果。

新建一个页面和一张样式表，把它们关联起来。添加下面清单中的HTML。

**清单15.1 创建一张简单卡片**

> [p371 代码清单一]

**图15.2 应用了旋转变换的简单卡片效果**

> [p372 图一]

接下来在样式表中添加下列清单中的CSS，其中包含了一些基础样式、颜色设置和应用了旋转变换的卡片样式。

**清单15.2 设置卡片样式并使用变换**

> [p372 代码清单一]
>
> Centers the card 使卡片居中
>
> Rotates the card 15 degrees to the right 使卡片向右旋转15度

在浏览器中加载页面，我们就可以看到旋转后的卡片。通过这个小实验，或多或少能感受到`rotate()`函数是怎样工作的。使用负角度可以使卡片向左侧旋转（可以试一下`rotate(-30deg)`）。

接下来可以尝试使用其他函数修改变换类型。使用下面的这些值，并观察它们的行为：

- `skew(20deg)`——使卡片倾斜20度。试试负角度，让卡片向其他方向倾斜。
- `scale(0.5)`——将卡片缩小至原始尺寸的一半。`scale()`函数需要一个无单位的数值，小于1表示要缩小元素，大于1表示要放大元素。
- `translate(20px, 40px)`——使元素向右移动20px，向下移动40px。同样，也可以使用负值使元素向相反的方向变换。

使用变换的时候要注意一件事情，虽然元素可能会被移动到页面上的新位置，但它不会脱离文档流。你可以在屏幕范围内以各种方式平移元素，其原始位置不会被其他元素占用。同样，当旋转某元素的时候，它的一角可能会移出屏幕边缘，也可能会遮住旁边其他元素的部分内容（图15.3）。

**图15.3 变换元素不会导致其他元素移动，所以可能会出现遮挡**

> [p373 图一]

某些情况下，为变换元素或者所有元素设置较大的外边距，有助于避免不必要的遮挡。

> **警告**
>
> 变换不能作用在`<span>`或者`<a>`这样的行内元素。若确实要变换此类元素，要么改变元素的display属性替换掉`inline`（比如`inline-block`），要么把元素改为flex或者grid项目（为父元素应用`display: flex`或者`display: grid`）。

### 15.1.1 更改变换基点

变换是围绕着`基点`（point of origin）发生的。基点是旋转的轴心，也是缩放或者倾斜开始的地方。这就意味着元素的基点是固定在某个位置上，元素的剩余部分围绕基点进行变换（对于`translate()`是个例外，因为平移过程中是元素整体移动的）。

默认情况下，基点就是元素的中心，但可以通过`transform-origin`属性改变基点位置。图15.4展示了一些围绕不同基点变换的元素。

**图15.4 使用元素上不同的角作为基点发生的旋转、缩放和倾斜**

> [p374 图一]
>
> Rotate around bottom right 围绕右下角旋转
>
> Scale around top right 围绕右上角缩放
>
> Skew around top left 围绕左上角倾斜

左侧的元素绕基点旋转，其基点设置为`transform-origin: right bottom`；中间的元素向着基点（`right top`）缩放；右侧元素的倾斜方式是，基点（`left top`）保持不动，元素其他部分向远处延伸。

基点也可以指定为百分比，从元素左上角开始测量。下面的两句声明是等价的：

```
transform-origin: right center;
transform-origin: 100% 50%;
```

> **注意**
>
> 也可以使用px、em或者其他单位的长度值来指定基点。按照我的经验，使用`top`、`right`、`bottom`、`left`和`center`这些关键字，在大部分项目中就够用了。

### 15.1.2 使用多重变换

可以对`transform`属性指定多个值，用空格隔开。变换的每个值将会从右向左按顺序执行。比如我们设置`transform: rotate(15deg) translate(15px, 0)`，元素会先向右平移15px，然后顺时针旋转15度。按照下面清单编辑样式表。

**清单15.3 使用多种变换**

> [p375 代码清单一]
>
> Translates 20 px right, then rotates 15 degrees clockwise 向右平移20px，然后顺时针旋转15度

最简单的查看这种效果的方法就是打开浏览器的开发者工具，实时修改属性值，看它们是如何影响元素的。注意修改`translate()`的值的时候，元素好像是沿着一个倾斜的坐标轴在移动，而不是正常的方向。这是因为旋转发生在平移之后。

理解起来可能有点儿困难。通常把`translate()`放在最后执行（在`transform`代码顺序中需要放在首位），这样操作更简便，可以使用正常的上/下、左/右坐标系。把代码调整为`transform: translate(20px, 0) rotate(15deg)`可以查看具体效果。

## 15.2 在运动中变换

变换本身不具备太多实用性。一个使用了`skew()`的盒子可能看上去很有趣，但并不适于阅读。当和动作结合起来使用的时候，变换就会有用得多了。

下面我们就创建新页面，实践一下这类用法。图15.5展示了将要实现的页面快照，我们接下来会为页面添加很多动作。

本章我们会实现左侧的导航菜单。最初的时候，菜单只有四个纵向排列的图标；鼠标悬浮的时候，菜单文字将会出现。这个实例包含多个过渡和一对变换。接下来我们先实现页面，然后进一步研究导航菜单（下一章中我们会实现中间主区域的卡片部分，并为其添加更多的变换和动画效果）。

新建页面和名为style.css的样式表，添加下列清单中的标记。代码中包含了一个链接，指向Google Fonts API提供的两款web字体（Alfa Slab One和Raleway）。代码中还包括页面的标题和导航菜单。

**图15.5 左侧的导航图标将由多个变换和过渡效果组成**

> [p376 图一]

**清单15.4 演示在运动中过渡的页面使用的标记**

> [p376 代码清单一]
>
> Adds Alfa Slab One and Raleway fonts to the page 为页面添加Alfa Slab One和Raleway两款字体
>
> [p377 代码清单一]
>
> Nav links each contain an image and a label 每个导航链接都包含一张图片和一个标签

`nav`元素包含了这段代码中的大部分内容，其中有个链接的无序列表（`<ul>`）。每个链接都由一个图标图片和一个文本标签组成。注意，这里的图标图片是SVG格式。后面你会发现这很重要，到时候会在下一章为页面添加更多内容。

> SVG——Scalable Vector Graphics的简称，可缩放矢量图形。这是一种基于XML的图片格式，使用向量定义图片。因为图片是使用数学计算来定义的，可以被放大或缩小到任意尺寸。几乎所有的浏览器都支持SVG。

接下来我们添加一些基础样式，包括背景渐变和标题区域的内边距，同时也为页面引入web字体。复制或者添加下面代码清单到样式表。这些只是基础样式和标题部分，菜单部分的布局后面再说。

**清单15.5 基础样式和标题样式**

> [p377 代码清单二]
>
> [p378 代码清单一]
>
> 【译者注：这段代码中body的第一句多了一个background-color:】
>
> Deep blue background gradient 深蓝色背景渐变
>
> Ensures that the body fills the viewport so the gradient fills the screen 确保body元素充满整个视窗，这样渐变就会充满屏幕
>
> Smaller padding for the header on mobile viewports 在移动视窗上为标题区域设置稍小的内边距
>
> Larger padding for the header on larger screens 在较大的屏幕上为标题区域设置稍大的内边距

这个示例用到了前面章节里的很多概念。body元素的背景使用了径向渐变，可以为页面增加一点立体感（Opera Mini浏览器不支持径向渐变，`background-color`为其提供了回退值）。web字体Alfa Slab One作用在标题上，Raleway用在正文主体。页面标题区域通过媒体查询设置了响应样式，屏幕尺寸足够大的时候添加更多的内边距。

要实现菜单需要分成几个步骤。首先完成菜单的布局，然后设置一些响应行为。我们采用移动优先的实现方案（见第8章），从小屏幕开始。标题和菜单看起来应该像图15.6这样。

**图15.6 导航菜单的移动设计**

> [p379 图一]

鉴于小屏幕上导航链接按水平方向排列，考虑使用弹性盒布局比较合适。我们对弹性容器设置`justify-content: space-between`（【译者注：原书中这里写错了，不是align-content，应该是justify-content】），这样导航项目之间可以平均地分配页面宽度。接下来我们设置字体颜色和图标对齐。把下列代码添加到样式表：

**清单15.6 导航菜单链接的移动样式**

> [p379 代码清单一]
>
> Uses a flexbox to spread the nav items across the screen horizontally 使用弹性盒布局在屏幕水平方向上展开导航项
>
> Styles the link text 为链接文本添加样式
>
> Moves icons down slightly to center them with the text labels 把图标向下稍微移动，与文本标签对齐
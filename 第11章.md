# 第四部分 深入研究

设计一套精致的UI界面是非常重要的。用户更倾向于相信一个看起来很专业的应用，如果网站设计得赏心悦目，他们可能会更乐意花时间来浏览。在本书最后6章，我们把重点放在设计考量上。一些小小的细节，可能会对网站的外观和体验产生重大的影响。



# 第11章 背景、阴影和混合模式

> 本章内容
>
> * 线性渐变和径向渐变
> * 盒阴影和文本阴影
> * 调整背景图片的尺寸和位置
> * 使用混合模式，让背景和内容相结合



关于CSS我们已经讲了很多东西。你已经对CSS的基本工作方式有了更深的理解，学会了多种布局方法，还学会了如何确保代码组织良好且易于维护。这些内容涵盖了从头开始建立一个网站所需的基本要素。你学到了这些知识，然后应用到实际项目中，可能感觉非常不错。但是这还不够！

一个网站，从看起来还可以，变成看起来非常优秀，重点在于细节。在实现了页面里某个组件并且写完样式之后，不要急着继续工作，可以有意识地训练自己，以一个挑剔的眼光，审视一下刚刚完成的代码。如果增加（或者减少）一点内边距是不是看起来更好？调整一下颜色，稍微变深或变浅，或者不要那么鲜艳，是不是效果更好一点？如果你正在开发设计师提供的带有很多细节的视觉稿，那么你的实现效果是否尽可能做到完美还原？设计师可是花费了很多精力推敲那些细节的，一定要认真对待这件事情。

要实现这些细节，CSS中那些需要艺术创意的部分就派上用场了。可能你跟大部分开发者一样，并不认为自己同时也是个设计师或者画家。但是只要你一直从事CSS相关的工作，总是偶尔有需要扮演其中某个角色。本书的第四部分重点关注这部分内容。

最后这几章都是关于细节工作的，看看还有哪些额外的东西可以添加到页面上。我们会教你一些设计上的小技巧，不要担心学不会，设计并不是你想象的那么高不可攀。我们会讲解一些具体的规则，告诉你如何使用颜色、间距、排版和动画。如果你想让自己的网站在提供完整功能的时候，还兼具视觉吸引力，那么这几章将会带给你一些启发。

本章介绍如何为网页添加视觉效果。以图11.1展示的按钮为例，它使用了背景渐变和投影两种特效，看上去有了立体的效果。背景颜色从顶部的中蓝色（#57b）过渡到底部的深蓝色（#148）。你可能都没有留意到这层渐变，但是再加上下方和右侧边缘的阴影效果，就让按钮整体呈现出了立体感。

**图11.1 添加了渐变背景和投影效果的按钮**

> [p280 图一]

本章接下来会讲解渐变和投影是如何工作的，也会展示一些实际应用的例子。还有一种非常有意思的特效叫`混合模式`（blend modes），可以把多个背景图片和背景颜色以不同方式组合在一起使用。

一般不太需要一次性把这些特效都添加到页面里，所以我们不会建一个大大的网页，而是拆分成多个小例子来演示。学会了这些特效，你就可以有选择地添加到你的各种项目里了。

## 11.1 渐变

前面的章节已经介绍了纯色背景和一些背景图片的使用方法。但是`background`属性依然还有很多的功能等待我们去探索，实际上，background是8个属性的简写：

- `background-image`——指定一个文件或者生成的颜色渐变作为背景图片
- `background-position`——设置背景图片的初始位置
- `background-size`——指定元素内背景图片的渲染尺寸
- `background-repeat`——在需要填充整个元素的时候，是否平铺图片
- `background-origin`——指定背景相对于元素的什么地方来定位，边框盒、内边距框盒（默认值）还是内容框盒？
- `background-clip`——指定背景填充区域，边框盒（默认值）、内边距框盒还是内容框盒？
- `background-attachment`——指定背景图片是随着元素上下滚动（默认值），还是图片被固定在视窗区域。需要注意，设置为`fixed`的时候会对页面性能产生一些影响。
- `background-color`——指定纯色背景，渲染到背景图片下方。

本章接下来我们会学习这些属性。现在需要了解的是，使用属性简写（`background`）可以设置指定的值，同时把其他都重置为默认值。基于这层原因，我们建议在需要用到多个属性的时候，还是使用单独的属性。

`background-image`属性非常有意思。我们已经知道这个属性可以接受一个图片URL路径（第8章里的`background-image: url(coffee-beans.jpg)`），它也可以接受一个渐变函数。例如，定义一个从白色过渡到蓝色的渐变，如图11.2所示。

**图11.2 白色到蓝色的线性渐变**

> [p281 图一]

渐变是一种非常有用的特效。在运行实例之前，我们先研究一下渐变是怎么工作的。为了方便试验，先创建一个新页面和样式表，添加下面代码清单中的CSS，其中使用了`linear-gradient()`函数定义了渐变。

**清单11.1 基础线性渐变**

> [p281 代码清单一]
>
> [p282 代码清单一]
>
> Fades to the right from white to blue  向右侧渐变，从白色过渡到蓝色

渐变实际上就是背景图片，渐变本身不会影响元素的尺寸。为了演示，我们给元素设置了明确的宽高。因为元素是空的，必须手动设置高度才能看到渐变效果。

`linear-gradient`函数使用三个参数来定义行为：角度、起始颜色和终止颜色。在这个例子中角度值是`to right`，意思是渐变从元素的左侧开始（这里是白色），平滑过渡到右侧（这里是蓝色）。也可以使用其他的颜色表示法，比如hex（`#0000ff`）、RGB（`rgb(0, 0, 255)`）或者`transparent`关键词。把下面清单中的元素添加到页面上查看渐变效果。

**清单11.2 带背景渐变的元素**

> [p282 代码清单二]

有好几种不同的方式来指定渐变的角度。在这个例子中，我们使用了`to right`，当然也可以使用`to top`或者`to bottom`。可以指定某个对角，比如`to bottom right`，这样的话，渐变会从元素的左上角开始，逐渐过渡到右下角。

我们可以使用更确切的方式（比如角度值单位），对角度实施更精确的控制。值`0deg`代表垂直向上（相当于`to top`），更大的角度值会沿着顺时针变化，所以`90deg`代表向右侧渐变，`180deg`代表向下方渐变，`360deg`又会代表向上方渐变。因此，下面的示例代码等价于之前的例子：

**清单11.3 使用角度值单位的渐变**

> [p282 代码清单三]
>
> 90deg value is equivalent to the value to right  90deg相当于to right

角度值是比较常用的单位，还有一些其他单位可以用来表示角度：

- `rad`——弧度（radian）。一个完整的圆是2π弧度，大概是6.2832弧度。
- `turn`——代表环绕圆周整圈的数目。1turn相当于360度（`360deg`）。可以使用小数来表示不足一圈，比如`0.25turn`相当于`90deg`。
- `grad`——百分度（gradian）。一个完整圆周是400百分度（`400grad`），`100grad`相当于`90deg`。

可以自己尝试一下为渐变设置不同的值，看看效果如何。

### 11.1.1 使用多个颜色节点

大部分渐变只需要两个颜色，从一个过渡到另一个。也可以定义包含多个颜色的渐变，其中每个颜色被称为一个`颜色节点`（color stop）。图11.3展示了一个包含三个颜色节点的渐变（红色、白色和蓝色）。

**图11.3 包含三个颜色节点的渐变（红色到白色再到蓝色）**

> [p283 图一]

为`linear-gradient()`函数添加更多的颜色，就可以插入多个颜色节点。按下面的代码清单更新一下样式表，然后在页面上查看渐变效果。

**清单11.4 包含多个颜色节点的线性渐变**

> [p283 代码清单一]
>
> Specifies multiple color stops  指定多个颜色节点

一个渐变可以接受任意数量的颜色节点，节点之间通过逗号分隔。渐变会自动处理，均匀地平铺这些颜色节点。在这个例子中，最左侧（0%）从红色开始，过渡到中间（50%）的白色，到最右侧的蓝色（100%）。我们也可以在渐变函数中为每个颜色节点明确地指定位置。清单11.4中的渐变等价于下面的代码：

```
linear-gradient(90deg, red 0%, white 50%, blue 100%)
```

从这个例子你可能已经猜到了，颜色节点的位置是可以调整的，不是必须均匀分布。除了使用百分比来定位以外，还可以使用像素、em或者其他长度单位。

**条纹**

如果在同一个位置设置两个颜色节点，那么渐变会选择直接从一个颜色变换到另一个，而不是平滑过渡。图11.4展示的渐变，从红色开始，直接变换到了白色，然后又变成了蓝色，整体呈现条纹状。

**图11.4 通过在同一位置放置两个颜色节点的渐变，实现条纹效果**

> [p284 图一]

实现的具体代码如下面清单所示，注意渐变中有四个颜色节点，其中两个是白色。

**清单11.5 同一个位置放置两个颜色节点，由此来创建条纹**

> [p284 代码清单一]
>
> Color stops on the same points 相同位置上的颜色节点

第一个颜色节点是红色，在40%的位置，所以渐变从左侧边缘一直到40%都是纯红色；第二个颜色节点是白色，也是在40%的位置，所以渐变在这里会直接变成白色；接下来在60%的位置还有一个白色颜色节点，所以40%到60%之间的渐变是纯白色；最后一个颜色节点也是在60%的位置，是蓝色，这样就会直接变换成蓝色，然后一直到右边都是蓝色。

**重复的渐变**

前面的例子虽然只是为了演示，但也可以用来实现一些有意思的效果，特别是搭配另一个稍微有点不同的渐变函数的时候，这个函数就是`repeating-linear-gradient()`。此函数和`linear-gradient`的效果基本相同，唯一的区别就是会重复。最终生成的条纹类似理发店门口的旋转招牌，用在进度条上效果非常棒（如图11.5）。

**图11.5 使用重复线性渐变的条纹状进度条**

> [p285 图二]

对于重复的渐变来讲，使用明确的长度好过使用百分比，因为设置的值决定了要重复的图片尺寸。下面的清单列出了条纹进度条的代码，可以更新到样式表查看效果。

**11.6 创建斜纹进度条**

> [p285 代码清单一]
>
> Stripes alternating between light and dark blue 深蓝和浅蓝色交替生成条纹

有时候，把一个半成品的代码片段改成自己需要的样子，比从头开始编码实现要容易一些。我们可以在[https://css-tricks.com/stripes-css/](https://css-tricks.com/stripes-css/)找到更多的例子。

### 11.1.2 使用径向渐变

径向渐变是另一类渐变。线性渐变是从元素的一端开始，沿着直线过渡到另一端，而径向渐变不同，它是从一个点开始，全方位向外扩展。图11.6展示了一个基础的例子。

**图11.6 由白色向蓝色过渡的径向渐变**

> [p285 图一]

参考下列清单中的径向渐变代码，编辑一下自己的样式表：

**清单11.7 基础径向渐变**

> [p285 代码清单二]
>
> Blends from a white center to blue edges 从中心的白色过渡到边缘的蓝色

默认情况下，渐变在元素中是从中心开始，平滑过渡到边缘。渐变整体呈椭圆形，跟随元素大小进行变化（也就是说，较宽的元素，其径向渐变也较宽，反之亦然）。

跟线性渐变一样，径向渐变同样支持颜色节点。你可以提供多个节点，使用百分比或者长度单位指定节点位置；也可以把径向渐变设置为圆形而非椭圆，甚至可以指定渐变中心点的位置。`repeating-radial-gradient()`函数可以重复生成图样，形成同心圆环。

这些特性大都可以通过示例解释清楚，图11.7列举了几个例子以及相应的代码。建议你在自己的页面中试验一下，或者尝试修改成自己的代码。

**图11.7 径向渐变的几个例子**

> [p286 图一]
>
> Basic gradient (ellipse) 基础渐变（椭圆）
>
> Circle gradient 圆形渐变
>
> Sized 3 em, centered 25% from the left and top edges 大小为3em，中心点距离左侧和顶部都为25%
>
> Radial gradient with explicit color stop positions 指定颜色节点位置的径向渐变
>
> Repeating gradient with stripes 重复的渐变生成条纹效果

在实际开发中，我发现对于径向渐变基本上不需要做太多复杂的编码，基本的应用形式已经可以满足大部分需求。如果你想更深入地研究一下，可以参考MDN的相关文档[https://developer.mozilla.org/en-US/docs/Web/CSS/radial-gradient](https://developer.mozilla.org/en-US/docs/Web/CSS/radial-gradient)。

前面的大部分例子都使用了对照明显的颜色，这么做是为了突出效果，让渐变的行为清晰明了。在实际的项目开发中，要尽量少用差异如此明显的渐变颜色。

比如不要使用从白色到黑色的渐变，可以从白色渐变到浅灰色；或者在两个细微差别的蓝色之间渐变。这样不会让用户产生不适。某些情况下用户可能都没有意识到渐变的存在，但这些渐变依然为页面营造了细微的立体感。后面我们会展示一些关于渐变的真实应用案例，但在那之前，先来学习一下阴影。

## 11.2 阴影

阴影是另一种可以为网页增加立体感的特效。有两个属性可以创建阴影，`box-shadow`可以为元素盒子生成阴影，`text-shadow`可以为渲染后的文本生成阴影。我们已经在前面的章节使用过一两次`box-shadow`了，现在进一步研究一下它是如何工作的。

`box-shadow: 1em 1em black`这样一句声明就可以生成图11.8所示的阴影。其中`1em`代表偏移量，即阴影从元素的位置偏移了多少距离（先水平方向，后垂直方向）。如果偏移量都设置为0，那么阴影会直接渲染在元素下方。`black`指明了阴影但颜色。

**图11.8 基本的盒子阴影**

> [p287 图一]

默认情况下，阴影与元素的大小和尺寸相同。如果元素设置了border-radius，阴影相应地也会有圆角。阴影的水平偏移量（`x`）、垂直偏移量（`y`）和颜色都不可缺省。还有另外两个值是可选的：模糊半径和扩展半径。完整的规则如图11.9所示。

**图11.9 盒阴影设置规则**

> [p287 图二]
>
> Offset (x) and offset (y)  水平偏移（x）和垂直偏移（y）
>
> blur radius 模糊半径
>
> Spread radius 扩展半径
>
> color 颜色

模糊半径用来控制阴影边缘模糊区域的大小，可以为阴影生成一个更柔和、有点透明的边。扩展半径用来控制阴影的大小，设置为正值可以使阴影全方位变大，设为负值则会变小。

### 11.2.1 使用渐变和阴影形成立体感

下面使用渐变和阴影来实现图11.10所示的按钮。由上至下的渐变可以使按钮产生弧形的3D效果，阴影加强了这种效果。我们还在这个例子中使用`:active`伪类创建了另一个阴影效果，供按钮摁下的时候使用。

**图11.10 使用了渐变和阴影但按钮，右边按钮展示的是激活（摁下时）状态**

> [p288 图一]

这里的渐变幅度很小，你可能开始的时候都没有察觉，但它确实为按钮带来了一些圆润的效果。阴影做了一些模糊处理，看起来更自然。按钮点击的时候，移除了阴影效果，取而代之的是在按钮的边框内出现了内阴影。这样按钮就有了一种被摁下的感觉，就仿佛用户真的在网页上按压按钮。释放鼠标按键以后，按钮又恢复了最初的效果，这是通过使用按钮的`:active`状态实现的。

为按钮新建一个网页和样式表，添加下列清单中的代码到页面中：

**清单11.8 按钮的标记**

> [p288 代码清单一]

接下来，添加下面清单中的样式。这些样式会覆盖掉用户浏览器提供的默认字体大小和边框，同时设置了按钮尺寸，并添加了渐变背景和盒阴影。

**清单11.9 使用了渐变和阴影的按钮样式**

> [p288 代码清单二]
>
> Gradient from light blue to medium blue 从浅蓝色到中蓝色的渐变
>
> Dark blue shadow with a 0.5 em blur 带0.5em模糊半径的深蓝色阴影
>
> Two inset box shadows 两个内部盒阴影

`background-image`属性提供了两个相似的蓝颜色组成的渐变。盒阴影偏移得不是很多，只向右和向下分别偏移了0.1em；模糊效果也比较温和，只有0.5em。阴影偏移得越大，就显得图片从网页上被“提起”得越高，立体感更强。激活状态下，按钮改变了盒阴影效果。

这里做了两件事。我们增加了一个`inset`关键词，用来替换之前的盒阴影。这样就可以使阴影出现在元素边框的内部，而非之前的外部。同时我们定义了不止一个阴影，用逗号分隔。通过这种方式可以添加多个阴影。

第一个内阴影（`inset 0 0 0.5em #124`）偏移量为0，有一个很小的模糊。第二个内阴影（`inset 0 0.5em 1em rgba(0,0,0,0.4)`）有一点垂直方向的偏移，这样就让按钮顶端的阴影延长了一些。RGBA颜色表示法定义了一个半透明的黑色。建议你自己动手修改一下这些值，看看它们到底是如何影响最终的渲染效果的。

> **注意**
>
> 在Chrome浏览器中点击按钮的时候，你会发现按钮周围环绕了一个淡蓝色的光圈，这是浏览器为按钮的`:focus`状态默认添加的轮廓线。可以通过设置`.button:focus { outline: none; }`来移除轮廓线。建议你在移除轮廓线的同时，添加一些其他的特效来代替，这样当用户使用键盘导航的时候，就可以看到当前焦点状态在哪里。

这种设计理念在前几年大范围使用，即把屏幕上的元素设计得如同真实世界的实物（这种设计风格被称为`拟物化设计`）。在真实世界中，物体不会有完美的纯色。即使是光滑的表面，受各种角度的光线影响，也会产生亮区和阴影区。

为按钮添加圆润饱满的外观、角度合适的阴影，就可以使其看起来像一个真实的物件。其他常见的拟物化设计的元素还有针织边框和类似皮革纹理的图片等。2010年至2013年间，这种设计风格慢慢被一种名为`扁平化设计`的风格替代。

### 11.2.2 使用扁平化设计创建元素

在拟物化设计追求尽量贴近真实世界的同时，扁平化设计选择拥抱现代社会已经日益数字化的事实。扁平化设计讲究色彩明快统一、外观简洁明了，这就意味着尽量少使用渐变、阴影和圆角。但比较戏剧性的是，扁平化设计的日渐兴起，反而是在这些千呼万唤才出台的CSS特效规范之后（在规范出台之前，阴影和渐变效果只能使用图片来实现）。

扁平化设计并不是说完全放弃使用这些特效，用还是要用的，要用得巧用得妙。举个例子，前面使用的渐变是从淡蓝色过渡到中蓝色，我们现在也可以使用两个不同蓝色的渐变，只是渐变幅度几乎察觉不到。或者某个元素有个特别小的阴影，小到几乎没有。

我们现在以扁平化的方式重新设计一下按钮。新的按钮样式如图11.11所示，现在看起来不再像是真实世界里的物件了，虽然按钮下方还是有一道淡淡的阴影。

**图11.11 扁平化外观的按钮**

> [p289 图一]

新按钮的CSS样式见下列代码清单，其中也包含了鼠标划过和激活状态下的样式。更新一下你的样式表。

**清单11.10 扁平化的按钮以及鼠标划过和激活状态**

> [p290 代码清单一]
>
> Solid background color (no gradient) 纯色背景（没有渐变）
>
> Very subtle shadow 淡淡的阴影
>
> Slightly darker hover and active states 鼠标划过和激活状态下，颜色都有一些加深

这里的盒阴影有一些改变，只有垂直方向上的偏移，这样就只有向下的阴影，跟之前看上去很自然的阴影角度不一样；同时使用了RGBA颜色表示法，其中红色、绿色和蓝色的值都是0（最终生成黑色），alpha值是0.15（几乎相当于透明了）。鼠标划过和激活状态的外观也是扁平化的，只是把背景颜色变成了更深更暗一点儿的蓝色。同时字体大小也增加了一些，这是扁平化设计兴起以来的另一种流行趋势。

### 11.2.3 让按钮看起来更时尚

时至今日，扁平化设计风格依然流行，只是一直在演化。通用的设计方案是介于扁平化设计与拟物化设计之间。下面我们再来实现一下图11.12所示的按钮，不要嫌麻烦，最后一次了哈。这次的视觉稿使用了两种不同风格的设计要素。

**图11.12 另一种类型的扁平化按钮（右侧展示的是激活状态）**

> [p290 图一]

新按钮依然算是简约设计，但是按钮底部有个厚厚的边框，这使得按钮看上去像一个正面视角的3D立方体。实际上这条深色的线并不是什么`边框`，而是不加模糊效果的`阴影`，因为阴影的边缘可以生成和边框圆角相同的圆弧。

激活状态时，按钮向下方移动了少量像素的距离，看上去就像按钮陷进了页面里，如同被按下一样。按照下面的清单更新样式表代码。

**清单11.11 当下流行的按钮样式**

> [p291 代码清单一]
>
> Adds back the rounded corners 改回了圆角效果
>
> Puts a solid shadow beneath the button (no blur) 按钮下方添加阴影（无模糊效果）
>
> Adds a subtle text shadow 添加细小的文本阴影
>
> Shifts the button down when clicked 点击的时候，按钮下移
>
> Reduces the size of the shadow to offset the transform 减少阴影的大小，用来抵消按钮的位移

这里的按钮以一种不同的方式使用`box-shadow`，不是叠加一个模糊效果的阴影，而是保持阴影边缘清晰。这样看起来就像一个厚厚的底部边框。但是跟真正的边框还是有一些区别的，因为它的圆角的弧度可以完美贴合元素的边框圆角。

这里的文字也添加了阴影效果。文本阴影跟盒阴影很像，不同的地方就是只有渲染后的文字有阴影，而不是整个元素盒子。文本阴影的语法也基本上完全一样：水平偏移量、垂直偏移量、模糊半径（可选）和颜色值。但文本阴影不支持`inset`关键字和扩展半径值。示例中的文字被赋予了深蓝色阴影，水平和竖直方向各偏移了1px。

激活状态下，我们也做了一些新的事情。我们使用了`transform`属性以及`translateY()`函数，使元素在屏幕上向下方移动了0.1em（后面第15章我们讲到transform的时候会深入讲解具体用法）。同时把盒阴影的垂直偏移量减少了同样的距离（从0.4em变为0.3em）。这样一来，按钮被摁下的时候，按钮移动，但盒阴影不会动。你可以点击一下按钮查看效果。

渐变和阴影有各种各样的方式组合使用。随着时间的推移，又会有新的设计风格流行起来。我们要做的就是，在看到某个网站的新的设计的时候，停下来花些时间，用浏览器的开发者工具检查一下，看看别人是如何实现的。不要觉得麻烦哦，见多才能识广。

## 11.3 混合模式

大部分情况下，不论是使用真正的图片还是渐变，元素一般都只会使用一张背景图片。但某些情况下你可能想要使用两张或者更多的背景图片，CSS是支持这么做的。

background-image属性可以接受任意数量的值，相互之间以逗号分隔：

```
background-image: url(bear.jpg), linear-gradient(to bottom, #57b, #148);
```

使用多个背景图片的时候，列表中排在前面的图片会渲染到排序靠后的图片上面。在这个例子中，bear.jpg会遮盖在线性渐变之上，渐变就会不可见。但如果我们使用两张背景图片，一般都是希望第二张图片也可以透视显示。这时候就可以使用`混合模式`（blend mode）。

如果你熟悉图片编辑软件，那你可能见过混合模式。混合模式用来控制叠放的图片如何融合在一起，有些模式的命名有点让人摸不着头脑，比如滤色（screen）、颜色加深（color-burn）、强光（hard-light）等。图11.13中演示的例子，是两张背景图片以正片叠底（multiply）混合模式组合生成的。两个背景使用了同一张图片，但是背景位置不同。

**图11.13 两张背景图片以正片叠底的方式组合在一起**

> [p292 图一]

最终呈现的效果很有意思，两张图片的副本虽然叠放在一起，但都清晰可见。而且混合模式跟普通的调整透明度的做法还不一样，并不会冲淡或者削弱整体的颜色。

> **注意**
>
> 如果一张图片有一些透明度，即使不使用混合模式，在它下方的其他背景也会通过透明区域显现出来。你可以用一张透明的png或者gif图片试一下，或者使用渐变，但是把`transparent`关键字设置为其中一个颜色节点。

下面我们创建一个元素，使用两个背景并混合成图11.13（【译者注】：原书这里写了figure11.3，应该是写错了，改成了“图11.13”）所示的样子。新建一个页面，添加下面清单所示的元素。后面的几个示例中会重复用到这个元素标记。

**清单11.12 混合背景的div**

> [p293 代码清单一]

接下来我们就用这个空元素来生成想要的效果。添加下列清单中的代码到样式表，并把样式表链接到页面。

**清单11.13 混合两张背景图片**

> [p293 代码清单二]
>
> A comma separates two background images. 使用逗号隔开的两张背景图片
>
> Specifies one value to apply to both background images 设置一个值，应用到所有的背景图片上
>
> Applies different background positions to each image 为每张背景图片设置不同的初始位置
>
> Applies the blend mode 使用混合模式

大部分背景相关的属性都可以接受多个值，以逗号分隔。background-positon就使用了两个值，第一个值将会应用到第一张背景图片上，第二个值应用到第二张背景图片上。`background-size`和`background-repeat`属性也可以接受多个值，但如果只设置一个值，就会应用到所有的背景图片。这里也使用了`min-height`属性，是为了确保元素不会显示成高度为0（因为是空元素）。

`background-size`属性可以接受两个特殊的关键字值，分别是`cover`和`contain`。使用`cover`值可以调整背景图片的尺寸，使其填充满整个元素，这样会导致图片的边缘被裁切掉一部分；使用`contain`值可以保证整个背景图片可见，但结果可能导致元素的一些地方不会被背景图片覆盖（就像“letterboxing”效果）（【译者注：letterboxing是一种屏幕宽高比显示方式，指的是16：9的图像要显示在4：3的设备上，为了保留画面完整性，图像与设备同宽，在上下添加黑边的显示模式】）。该属性也可以接受长度值，用来明确设置背景图片的宽度和高度。

尝试修改其他的混合模式的值，查看它们有哪些不同效果，比如`color-burn`或者`difference`。你会发现很有趣，但你可能会疑惑这些混合模式到底有什么实用性。这里列举一些实际应用：

- 使用某种颜色或者渐变为图片着色；
- 为图片添加纹理效果，比如划痕或者老胶片放映时的颗粒感等
- 缓和、加深或者减少图片的对比度，使图片上的文字更具可读性；
- 在图片上覆盖了一条文字的banner，但是还想让图片完整显示。

下面我们先来看一下这些应用的实例，然后会通过一个明细列表简要介绍所有可用的混合模式。

### 11.3.1 为图片着色

通过使用混合模式，我们可以把一张全彩色图片着色成单一色相的图片。下面演示一下把前面的大熊图片渲染成蓝色，如图11.14所示。（请注意：如果你是在已出版书籍上阅读这部分内容，图片可能并不是彩印。可以通过本书电子版或者在浏览器中运行一下实例来查看完整效果）

**图11.14 使用单一蓝色色相着色的照片**

> [p294 图片一]

`background-blend-mode`不仅仅合并多个背景图片，还会合并`background-color`。所有这些叠放的图层，最终都会被混合模式拼合在一起，所以我们可以把背景颜色设置为想要的色相，混合到图片中去。按下面清单更新一下CSS代码。

**清单11.14 将背景颜色的色相混合到背景图片上**

> [p294 代码清单一]
>
> Blue background color 蓝色的背景颜色
>
> Uses luminosity blend mode 使用明度混合模式

明度（luminosity）混合模式使用前景层（大熊图片）的明度，与背景层（蓝色背景色图层）的色相和饱和度做混合。也就是说，最终的结果色完全使用背景色图层的颜色，但是明暗程度来自大熊图片。

明度混合模式（还有其他几种类似的混合模式）最终的渲染结果，取决于哪个图层在其他图层之上，一定要牢记，这是非常重要的。背景色图层始终在最下层，其它的背景图片都叠放在背景色图层之上。

假如我们把一个蓝色的图层放在大熊图层上面而不是下面（使用渐变色来代替背景颜色），最终的渲染结果就会变得不同。在这种情况下，为了达到同样的效果，就需要使用颜色（color）混合模式（颜色混合模式与明度混合模式恰好相反，使用前景色的色相和饱和度与背景色的明度来生成最终的结果色）。

### 11.3.2 理解混合模式的类型

CSS支持15种混合模式，每一种都使用不同的计算原理来控制生成最终的混合结果。对每一个像素来说，就是取一个图层上的像素颜色，与其他图层上对应像素的颜色拼合计算，生成一个新的像素颜色，最终生成一张混合图片。

表11.1列出了所有的混合模式。这些混合模式又可以划分为五类：变暗、变亮、对比、复合和比较。有的模式在实际应用中可能更有用一点，需要反复的摸索尝试才能选出最合适的混合模式。

**表11.1 把混合模式分成五个大类**

> [p295 表一]
>
> [p296 表一]
>
> | 效果分类 | 混合模式 | 描述                                                         |
> | -------- | -------- | ------------------------------------------------------------ |
> | 加深效果 | 正片叠底 | 前景色越亮，背景色显示出来的越多。                           |
> |          | 变暗     | 选择两个颜色中更暗的那个                                     |
> |          | 颜色加深 | 加深背景色，增加对比度                                       |
> | 减淡效果 | 滤色     | 前景色越暗，背景色显示出来的越多                             |
> |          | 变亮     | 选择两个颜色中更亮的那个                                     |
> |          | 颜色减淡 | 加亮背景色，降低对比度                                       |
> | 对比效果 | 叠加     | 对暗色使用`正片叠底`，对亮色使用`滤色`，以增加对比度，对比效果较柔和 |
> |          | 强光     | 大幅增加对比度，有点像`叠加`，但是使用加强版的`正片叠底`或者`滤色`，对比效果明显 |
> |          | 柔光     | 有点类似`强光`，但是使用`颜色加深`/`颜色减淡`来代替`正片叠底`/`滤色` |
> | 复合效果 | 色相     | 将上层颜色的色相混合到下层颜色上                             |
> |          | 饱和度   | 将上层颜色的饱和度混合到下层颜色上                           |
> |          | 明度     | 将上层颜色的明度混合到下层颜色上                             |
> |          | 颜色     | 将上层颜色的色相和饱和度混合到下层颜色上                     |
> | 比较效果 | 差值     | 从亮色中减去暗色                                             |
> |          | 排除     | 类似`差值`，但对比度稍弱                                     |

编写本书的时候，大部分主要浏览器已经支持多数混合模式了，当然IE和Edge浏览器是个例外。复合效果混合模式在Safari浏览器中也是不支持的（【译者注：Safari浏览器从10.1版本已经开始支持复合效果的混合模式】），必要的时候可以使用特性查询并提供降级处理（详见第六章6.5章节）。可以访问[https://caniuse.com/#feat=css-backgroundblendmode](https://caniuse.com/#feat=css-backgroundblendmode)查看最新的浏览器支持情况。

### 11.3.3 为图片添加纹理

混合模式的另一个应用场景就是为图片添加纹理效果。比如你有一张清晰的富有现代气息的照片，但有时候出于风格考虑，你想让照片显得有些不同。这时候就可以使用灰度图为照片手动添加胶片噪点效果或者其他纹理。

观察一下图11.15展示的图片。这张图片跟前面使用的大熊图片一样，但是混合了一张纹理图片以后，就呈现出类似粗制帆布的外观效果。这种类型的效果可以通过对比类的混合模式来实现，使用`叠加`、`强光`或者`柔光`中的一种。这个例子中，我们不希望更改图片的色相，所以使用一张灰度图片来提供纹理，这样原始的颜色就会保留下来。

实现纹理叠加的代码如下列清单所示。纹理图片以重复平铺的方式覆盖在大熊图片上方。按照清单代码更新样式表，并在浏览器中查看实际效果。

**清单11.15 使用`柔光`混合模式为图片添加纹理**

（【译者注：清单11.15这个标题的原文是Using hard-light，然而代码里却是使用soft-light，我在浏览器里实际运行了一下，若要实现图11.15所示的图片效果，需要使用柔光，故原文中标题这里写错了，改成了“柔光”】）

> [p296 代码清单一]
>
> Layers the texture in front of the primary image 将纹理图片覆盖在主图片之上
>
> Tiles the texture image every 200 px 每200px平铺一张纹理图片
>
> Blends with soft-light 使用柔光混合模式

**图11.15 混合了纹理的图片**

> [p297 图一]

纹理图片（图11.16）的background-size设置为200px，同时允许背景图片重复，这样就可以使纹理图片平铺充满整个元素。同时，第二张图片的background-size设置为cover，且不允许重复，这样就不会平铺。

**图11.16 灰度模式的帆布纹理图片**

我们发现`柔光`模式对于暗色系纹理图片效果很好，而`强光`和`叠加`模式更适用于亮色的纹理图片（如果纹理图片放在主图片下面则恰好相反）。然而实际应用效果可能差别很大，这也取决于你的设计需要和基础图片的暗色程度。

### 11.3.4 使用融合混合模式

虽然`background-blend-mode`可以实现多张图片的混合，但只能局限于元素的背景颜色或者背景图片使用。还有一个属性`mix-blend-mode`，可以融合多个元素。这样不仅可以混合图片，还可以把元素的文本和边框与容器的背景图片混合在一起。使用融合混合模式，可以把标题显示在图片上方，但遮住的图片部分依然可以显示出来，如图11.17所示。

**图11.17 标题和下面的图片混合在一起**

> [p298 图一]

融合后的效果很有意思，文字看上去是透明的，就像红色横幅通栏被剪掉了一部分。这里我们使用了`强光`混合模式和中灰色文本颜色。对比类型混合模式在使用很亮或很暗的颜色时才会有更好的效果，这里的文字我们使用了中灰色（#808080），背景图层显示出来之后没有太大变化。

首先我们需要把标题添加到标签里，然后作为子元素添加到容器中。按下列清单更新代码，到浏览器里查看结果。

**清单11.16 添加标题到容器中**

> [p298 代码清单一]

为`<h1>`标签增加样式，最终效果为红色的纯色背景通栏、亮灰色顶部和底部宽边框、灰色文字。然后应用融合混合模式，整个元素被视为一个图层，和下面的容器里的背景图片混合在一起。更新下列代码到样式表中。

**清单11.17 使用融合混合模式来混合多个元素**

> [p299 代码清单一]
>
> Uses hard-light blend mode 使用强光混合模式
>
> Sets text and background color for the foreground element 为前景元素设置文本和背景颜色

这里的标题文字没有很强的对比效果，所以操作起来要小心。我们设置了大字号和粗体，这样在对比不太强的背景图片上，文字依然清晰易读。在这个例子中，标题就是被置于图片中对比度较小的深色区域。

混合模式在设计中有很多有趣的用法。使用混合模式，结合渐变和阴影，可以为页面添加很多有意思的视觉效果。但是凡事都有两面，记得合理使用，过犹不及哦！

#### 总结

- 使用渐变和阴影为页面增加立体效果；
- 基本的扁平化设计也可以少量应用阴影和渐变；
- 渐变带有明确界线的颜色节点，可以为元素添加条纹效果；
- 小巧的背景渐变比纯色背景更能提升设计效果；
- 使用混合模式可以为图片着色或者添加纹理效果。